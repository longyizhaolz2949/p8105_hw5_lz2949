p8105_hw5_lz2949
================
Longyi Zhao
2023-11-03

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.2     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(broom)
library(ggplot2)
```

## Problem 1

``` r
homi_data = read_csv(file = "./data/homicide-data.csv")
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
# Create a city_state variable
homi_data  = 
  homi_data |>
  mutate(city_state = paste(city,state,sep = ", "))

# summary and count number of homicides 
summary_data = homi_data |>
  group_by(city_state) |>
  summarise(
    homi_solved = sum(disposition == 'Closed by arrest'),
    homi_unsolved = sum(disposition == 'Open/No arrest' | disposition == 'Closed without arrest')
  )
```

Description:

``` r
# in 'Baltimore, MD' estimate the proportion of homicides that are unsolved. 
balt_md = summary_data |>
  filter(city_state == "Baltimore, MD") |>
  mutate(sum_homi = sum(homi_solved, homi_unsolved)) |>
  do ({prop.test(.$homi_unsolved, .$sum_homi) |>
  broom::tidy() })|>
  select(estimate, conf.low, conf.high) |>
  mutate(city_state = "Baltimore, MD") 
```

``` r
# run prop.test for each of the city
result_df <- summary_data |>
  group_by(city_state) |>
  summarize(prop_test_results = map(homi_unsolved, ~ prop.test(.x, .x +homi_solved) |>
  broom::tidy())) |>
  unnest(prop_test_results) |>
  select(city_state, estimate, conf.low, conf.high) 
```

    ## Warning: There was 1 warning in `summarize()`.
    ## ℹ In argument: `prop_test_results = map(homi_unsolved,
    ##   ~broom::tidy(prop.test(.x, .x + homi_solved)))`.
    ## ℹ In group 49: `city_state = "Tulsa, AL"`.
    ## Caused by warning in `prop.test()`:
    ## ! Chi-squared approximation may be incorrect

``` r
print(result_df)
```

    ## # A tibble: 51 × 4
    ##    city_state      estimate conf.low conf.high
    ##    <chr>              <dbl>    <dbl>     <dbl>
    ##  1 Albuquerque, NM    0.386    0.337     0.438
    ##  2 Atlanta, GA        0.383    0.353     0.415
    ##  3 Baltimore, MD      0.646    0.628     0.663
    ##  4 Baton Rouge, LA    0.462    0.414     0.511
    ##  5 Birmingham, AL     0.434    0.399     0.469
    ##  6 Boston, MA         0.505    0.465     0.545
    ##  7 Buffalo, NY        0.612    0.569     0.654
    ##  8 Charlotte, NC      0.300    0.266     0.336
    ##  9 Chicago, IL        0.736    0.724     0.747
    ## 10 Cincinnati, OH     0.445    0.408     0.483
    ## # ℹ 41 more rows

``` r
ggplot(result_df, aes(x = city_state, 
                      y = estimate, 
                      color = city_state
                      )) +
  geom_point(size = 2) +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
  labs(
    title = "Estimated Proportions and Confidence Intervals by City",
    x = "City",
    y = "Estimated Proportion of Unsolved Homicides"
  ) +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  theme(legend.position = "none")
```

![](p8105_hw5_lz2949_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

``` r
# drop legend?
```
